<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Health Check Dashboard - Training Guide</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 { margin: 0; font-size: 2.5em; font-weight: 300; }
        .header p { margin: 10px 0 0 0; opacity: 0.9; font-size: 1.1em; }
        .section {
            padding: 30px;
            border-bottom: 1px solid #eee;
        }
        .section:last-child { border-bottom: none; }
        .section-title {
            font-size: 1.8em;
            color: #333;
            margin-bottom: 25px;
            font-weight: 600;
            border-bottom: 3px solid #4facfe;
            padding-bottom: 15px;
        }
        .panel-box {
            background: #f8f9ff;
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            border-left: 5px solid #4facfe;
        }
        .new-panel-box {
            background: #f0fff8;
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            border-left: 5px solid #28a745;
        }
        .old-panel-box {
            background: #fff8f0;
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            border-left: 5px solid #ff9500;
        }
        .formula {
            background: #f5f5f5;
            padding: 18px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            font-size: 15px;
            line-height: 1.6;
        }
        .status-row {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .status-item {
            flex: 1;
            min-width: 180px;
            padding: 15px;
            text-align: center;
            border-radius: 10px;
            font-weight: bold;
            font-size: 15px;
        }
        .green { background: #d4edda; color: #155724; }
        .yellow { background: #fff3cd; color: #856404; }
        .red { background: #f8d7da; color: #721c24; }
        .calc-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-top: 25px;
        }
        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin: 20px 0;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .input-group label {
            font-size: 15px;
            font-weight: 600;
            color: #555;
        }
        input[type="number"] {
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
        }
        input:focus {
            outline: none;
            border-color: #4facfe;
        }
        .btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin: 15px 10px;
            font-size: 16px;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(79, 172, 254, 0.3);
        }
        .btn-secondary {
            background: #6c757d;
        }
        .results {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-top: 20px;
        }
        .result-summary {
            text-align: center;
            font-size: 1.6em;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
        }
        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .result-card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
        }
        .status-dot {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 10px;
        }
        .healthy { background: #28a745; }
        .warning { background: #ffc107; }
        .critical { background: #dc3545; }
        .example {
            background: #fff8e1;
            padding: 18px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 5px solid #ffa726;
            font-size: 15px;
        }
        .key-insight {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #2196f3;
        }
        .business-note {
            background: #f3e5f5;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #9c27b0;
        }
        @media (max-width: 768px) {
            .container { margin: 10px; }
            .section { padding: 20px; }
            .input-row { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè• Client Health Check Dashboard</h1>
            <p>Complete Training Guide - Understanding Health Metrics & Calculations</p>
        </div>
        
        <!-- Dashboard Overview -->
        <div class="section">
            <div class="section-title">üìä Dashboard Overview</div>
            
            <div class="key-insight">
                <h3>üéØ Purpose</h3>
                <p>This dashboard monitors the operational health of practice management clients by comparing current week performance against previous week across key business metrics.</p>
            </div>
            
            <div class="business-note">
                <h3>üìà Key Business Questions Answered</h3>
                <ul>
                    <li><strong>Are our clients maintaining consistent business operations?</strong></li>
                    <li><strong>Which clients need immediate attention due to declining performance?</strong></li>
                    <li><strong>How many new clients haven't started generating business activity?</strong></li>
                    <li><strong>What are the daily usage trends across our platform?</strong></li>
                </ul>
            </div>
        </div>

        <!-- Weekly Health Status Panel -->
        <div class="section">
            <div class="section-title">üö¶ Weekly Health Status Panel</div>
            
            <div class="business-note">
                <h3>üìã Panel Description</h3>
                <p><strong>What it shows:</strong> Week-over-week comparison of 4 key business metrics for each client company, with an overall health score.</p>
                <p><strong>Business Value:</strong> Immediately identifies clients experiencing operational difficulties or improvements.</p>
                <p><strong>Tooltip:</strong> "Week-over-Week Health Status: Last 7 days vs. previous 7 days comparison."</p>
            </div>

            <div class="new-panel-box">
                <h3>üÜï NEW Calculation Method (Current)</h3>
                <div class="formula">Performance Ratio = Current Week √∑ Previous Week</div>
                
                <div class="status-row">
                    <div class="status-item green">üü¢ Healthy: Ratio ‚â• 1.0 (Equal or better performance)</div>
                    <div class="status-item yellow">üü° Warning: 0.7 ‚â§ Ratio < 1.0 (Up to 30% decline)</div>
                    <div class="status-item red">üî¥ Critical: Ratio < 0.7 (More than 30% decline) OR no activity</div>
                </div>
                
                <div class="example">
                    <strong>NEW Example:</strong> Appointments - Current: 14, Previous: 27<br>
                    Ratio = 14 √∑ 27 = 0.519 ‚Üí Since 0.519 < 0.7 ‚Üí üî¥ Critical<br>
                    <strong>Business Interpretation:</strong> Client experienced a 48% drop in appointments (more than 30% threshold)
                </div>
            </div>

            <!--<div class="old-panel-box">
                <h3>üîÑ OLD Calculation Method (Legacy)</h3>
                <div class="formula">Performance Ratio = Current Week √∑ Previous Week</div>
                
                <div class="status-row">
                    <div class="status-item green">üü¢ Healthy: Ratio ‚â• 0.9 (90%+ performance)</div>
                    <div class="status-item yellow">üü° Warning: 0.5 ‚â§ Ratio < 0.9 (50-89% performance)</div>
                    <div class="status-item red">üî¥ Critical: Ratio < 0.5 (Below 50%) OR no activity</div>
                </div>
                
                <div class="example">
                    <strong>OLD Example:</strong> Same data - Current: 14, Previous: 27<br>
                    Ratio = 14 √∑ 27 = 0.519 ‚Üí Since 0.519 ‚â• 0.5 but < 0.9 ‚Üí üü° Warning<br>
                    <strong>Result:</strong> Less sensitive to performance drops
                </div>
            </div>-->

            <div class="panel-box">
                <h3>‚≠ê Overall Health Score Calculation</h3>
                <div class="formula">
                    Health Score = ((Healthy Count √ó 1.0) + (Warning Count √ó 0.5) + (Critical Count √ó 0.0)) √∑ 4 metrics √ó 100%
                </div>
                <div class="example">
                    <strong>Example:</strong><br>
                    ‚Ä¢ Appointments: Healthy = 1.0 point<br>
                    ‚Ä¢ Invoices: Warning = 0.5 points<br>
                    ‚Ä¢ Claims: Critical = 0.0 points<br>
                    ‚Ä¢ EOBs: Healthy = 1.0 point<br>
                    <strong>Total:</strong> (1.0 + 0.5 + 0.0 + 1.0) √∑ 4 √ó 100% = 62.5%
                </div>
            </div>

            <div class="panel-box">
                <h3>üîç Special Edge Cases (NEW Method)</h3>
                <div class="formula">
                    ‚Ä¢ Both weeks = 0: Critical (complete inactivity)<br>
                    ‚Ä¢ Previous = 0, Current > 0: Healthy (new activity started)<br>
                    ‚Ä¢ Previous > 0, Current = 0: Critical (activity stopped)
                </div>
                <div class="example">
                    <strong>Business Logic:</strong> Zero activity is never considered healthy unless new activity is starting.
                </div>
            </div>

            <div class="key-insight">
                <h3>üìä Four Metrics Monitored</h3>
                <ul>
                    <li><strong>Appointments Rendered (Count):</strong> Patient appointments completed</li>
                    <li><strong>Invoices Posted (Count):</strong> Bills generated for services</li>
                    <li><strong>Claims Accepted by Payor (Count):</strong> Insurance claims processed</li>
                    <li><strong>EOBs Received:</strong> Explanation of Benefits received from insurers</li>
                </ul>
            </div>

            <div class="calc-section">
                <h3>üßÆ Weekly Health Calculator - Compare Methods</h3>
                
                <div class="input-row">
                    <div class="input-group">
                        <label>üìä Current Week Value</label>
                        <input type="number" id="currentWeek" placeholder="Enter current week value" min="0">
                    </div>
                    <div class="input-group">
                        <label>üìä Previous Week Value</label>
                        <input type="number" id="lastWeek" placeholder="Enter previous week value" min="0">
                    </div>
                </div>
                
                <button class="btn" onclick="calculateWeeklyHealth()">Calculate Status (Both Methods)</button>
                <button class="btn btn-secondary" onclick="clearWeekly()">Clear</button>
                
                <div id="weeklyResults" class="results" style="display:none;">
                    <div class="result-summary">
                        <div id="statusResult"></div>
                        <div id="healthScore"></div>
                    </div>
                    <div class="result-details">
                        <div class="result-card">
                            <h4>üìä Calculation Details</h4>
                            <div id="calculationDetails"></div>
                        </div>
                        <div class="result-card">
                            <h4>üìà Method Comparison</h4>
                            <div id="performanceAnalysis"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Companies Without Activities Panel -->
        <div class="section">
            <div class="section-title">üè¢ Companies Without Activities Panel</div>
            
            <div class="business-note">
                <h3>üìã Panel Description</h3>
                <p><strong>What it shows:</strong> List of companies that have been onboarded but haven't generated any system activity yet.</p>
                <p><strong>Business Value:</strong> Identifies new clients who may need onboarding assistance or technical support.</p>
                <p><strong>Tooltip:</strong> "Companies Without Activity: Onboarded companies with no system activity (appointments, invoices, claims, logins, etc.)."</p>
            </div>

            <!--<div class="panel-box">
                <h3>üîç Selection Criteria</h3>
                <div class="formula">
                    Companies are included if:<br>
                    ‚Ä¢ IsActive = 1 (Active companies only)<br>
                    ‚Ä¢ IsTestCompany = 0 (Exclude test accounts)<br>
                    ‚Ä¢ No records in tblPMEnvironmentMetrics (No system activity)<br>
                    ‚Ä¢ Not in demo companies list<br>
                    ‚Ä¢ Within selected environment filter
                </div>
            </div>-->

            <div class="key-insight">
                <h3>üìä Data Displayed</h3>
                <ul>
                    <li><strong>Company Name:</strong> Client organization name</li>
                   <!-- <li><strong>Environment:</strong> System environment (Production, Staging, etc.)</li>-->
                    <li><strong>Onboarded On:</strong> Date company was set up in system</li>
                    <li><strong>Days Since Onboarded:</strong> Number of days since setup</li>
                </ul>
            </div>

            <div class="example">
                <strong>Business Use Cases:</strong><br>
                ‚Ä¢ <strong>Follow-up Actions:</strong> Contact companies onboarded >7 days ago<br>
                ‚Ä¢ <strong>Success Metrics:</strong> Track time-to-first-activity<br>
                ‚Ä¢ <strong>Support Prioritization:</strong> Focus on companies >30 days without activity
            </div>
        </div>

        <!-- Overtime Stats Panels -->
        <div class="section">
            <div class="section-title">üìà Overtime Stats Panels</div>
            
            <div class="business-note">
                <h3>üìã Panel Description</h3>
                <p><strong>What they show:</strong> Trend charts showing daily system usage over time.</p>
                <p><strong>Business Value:</strong> Monitor adoption trends, identify usage patterns, and spot potential issues.</p>
            </div>

            <div class="panel-box">
                <h3>üë• Daily User Logins Panel</h3>
                <div class="formula">
                    Query: SUM(UsersLoggedIn) per day, grouped by environment<br>
                    Tooltip: "Total users logged into the system each day"
                </div>
                <div class="example">
                    <strong>Business Insights:</strong><br>
                    ‚Ä¢ <strong>Usage Trends:</strong> Are clients actively using the system?<br>
                    ‚Ä¢ <strong>Environment Comparison:</strong> Which environments are most popular?<br>
                    ‚Ä¢ <strong>Adoption Rate:</strong> Is daily usage growing or declining?
                </div>
            </div>

            <div class="panel-box">
                <h3>üìÖ Daily Appointments Panel</h3>
                <div class="formula">
                    Query: SUM(AppointmentsRendered) per day, grouped by environment<br>
                    Tooltip: "Total appointments rendered in the system each day"
                </div>
                <div class="example">
                    <strong>Business Insights:</strong><br>
                    ‚Ä¢ <strong>Clinical Activity:</strong> Volume of patient care being delivered<br>
                    ‚Ä¢ <strong>Business Health:</strong> Core revenue-generating activity trends<br>
                    ‚Ä¢ <strong>Seasonal Patterns:</strong> Identify cyclical usage patterns
                </div>
            </div>
        </div>

        <!-- Environment Metrics Table -->
        <div class="section">
            <div class="section-title">üìä Environment Metrics Table</div>
            
            <div class="business-note">
                <h3>üìã Panel Description</h3>
                <p><strong>What it shows:</strong> Detailed daily metrics breakdown by company and environment.</p>
                <p><strong>Business Value:</strong> Granular view of individual client performance and activity patterns.</p>
            </div>

            <div class="panel-box">
                <h3>üìä Metrics Included</h3>
                <div class="formula">
                    ‚Ä¢ Company & Environment details<br>
                    ‚Ä¢ Onboarded On date<br>
                    ‚Ä¢ Day of week<br>
                    ‚Ä¢ Date of activity<br>
                    ‚Ä¢ Total appointments (hours)<br>
                    ‚Ä¢ Appointments Rendered (hours)<br>
                    ‚Ä¢ Appointments Cancelled (hours)<br>
                    ‚Ä¢ Total appointments (count)
                </div>
            </div>

            <div class="key-insight">
                <h3>üí° Analysis Capabilities</h3>
                <ul>
                    <li><strong>Client Comparison:</strong> Compare performance across different clients</li>
                    <li><strong>Day-of-Week Analysis:</strong> Identify weekly patterns</li>
                    <li><strong>Cancellation Rates:</strong> Monitor appointment cancellation trends</li>
                    <li><strong>Utilization Tracking:</strong> Hours vs count metrics analysis</li>
                </ul>
            </div>
        </div>

        <!-- Training Summary -->
        <div class="section">
            <div class="section-title">üéì Training Summary</div>
            
            <div class="key-insight">
                <h3>üîë Key Takeaways</h3>
                <ul>
                    <li><strong>Health Status:</strong> NEW method is more sensitive (30% vs 50% thresholds)</li>
                    <li><strong>Monitoring Focus:</strong> Identify declining clients early for intervention</li>
                    <li><strong>Onboarding Success:</strong> Track new clients' time-to-activity</li>
                    <li><strong>Usage Trends:</strong> Monitor daily login and appointment volumes</li>
                    <li><strong>Data Quality:</strong> All panels exclude test/demo data for accuracy</li>
                </ul>
            </div>

            <div class="business-note">
                <h3>üìã Action Items Based on Dashboard</h3>
                <ul>
                    <li><strong>Red Status Clients:</strong> Immediate outreach and support</li>
                    <li><strong>Yellow Status Clients:</strong> Monitor closely, proactive check-in</li>
                    <li><strong>No Activity Companies:</strong> Follow-up on onboarding progress</li>
                    <li><strong>Declining Trends:</strong> Investigate root causes and solutions</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        function calculateWeeklyHealth() {
            const current = parseFloat(document.getElementById('currentWeek').value) || 0;
            const last = parseFloat(document.getElementById('lastWeek').value) || 0;

            // New Thresholds
            const greenThresholdNew = 1.0;
            const yellowThresholdNew = 0.7;

            // Old Thresholds
            const greenThresholdOld = 0.9;
            const yellowThresholdOld = 0.5;

            // Function to determine status
            function getStatus(current, last, green, yellow) {
                if (current === 0 && last === 0) return 'Critical';
                if (current === 0 && last > 0) return 'Critical';
                if (last === 0 && current > 0) return 'Healthy';
                const ratio = current / last;
                if (ratio >= green) return 'Healthy';
                if (ratio >= yellow) return 'Warning';
                return 'Critical';
            }

            // Calculate statuses
            const statusNew = getStatus(current, last, greenThresholdNew, yellowThresholdNew);
            const statusOld = getStatus(current, last, greenThresholdOld, yellowThresholdOld);

            // Calculate ratio and change
            let ratioValue = (last === 0) ? 'N/A' : (current / last).toFixed(3);
            let changePercent = (last === 0) ? 'N/A' : (((current - last) / last) * 100).toFixed(1);
            if (changePercent !== 'N/A') {
                changePercent = (parseFloat(changePercent) >= 0) ? `+${changePercent}%` : `${changePercent}%`;
            }

            // Calculate health scores
            let healthScoreNew = statusNew === 'Healthy' ? 100 : statusNew === 'Warning' ? 50 : 0;
            let healthScoreOld = statusOld === 'Healthy' ? 100 : statusOld === 'Warning' ? 50 : 0;

            // Display results
            document.getElementById('statusResult').innerHTML = `
                <div><strong>üÜï New Method:</strong> <span class='status-dot ${statusNew.toLowerCase()}'></span>${statusNew}</div>
                <div><strong>üîÑ Old Method:</strong> <span class='status-dot ${statusOld.toLowerCase()}'></span>${statusOld}</div>
            `;
            
            document.getElementById('healthScore').innerHTML = `
                <div><strong>New Health Score:</strong> ${healthScoreNew}%</div>
                <div><strong>Old Health Score:</strong> ${healthScoreOld}%</div>
            `;

            document.getElementById('calculationDetails').innerHTML = `
                <div><strong>Current Week:</strong> ${current}</div>
                <div><strong>Previous Week:</strong> ${last}</div>
                <div><strong>Ratio:</strong> ${ratioValue}</div>
                <div><strong>Change:</strong> ${changePercent}</div>
            `;

            document.getElementById('performanceAnalysis').innerHTML = `
                <div><strong>New Thresholds:</strong></div>
                <div>üü¢ Green ‚â• ${greenThresholdNew} (100%+ performance)</div>
                <div>üü° Yellow ‚â• ${yellowThresholdNew} (70-99% performance)</div>
                <div>üî¥ Red < ${yellowThresholdNew} (Below 70%)</div>
                <br>
                <div><strong>Old Thresholds:</strong></div>
                <div>üü¢ Green ‚â• ${greenThresholdOld} (90%+ performance)</div>
                <div>üü° Yellow ‚â• ${yellowThresholdOld} (50-89% performance)</div>
                <div>üî¥ Red < ${yellowThresholdOld} (Below 50%)</div>
            `;
            
            document.getElementById('weeklyResults').style.display = 'block';
        }

        function clearWeekly() {
            document.getElementById('currentWeek').value = '';
            document.getElementById('lastWeek').value = '';
            document.getElementById('weeklyResults').style.display = 'none';
        }
    </script>
</body>
</html>
